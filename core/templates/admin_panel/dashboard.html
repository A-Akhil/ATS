{% extends 'base.html' %}

{% block title %}Admin Dashboard{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
	<div class="bg-gradient-to-r from-indigo-600 via-purple-600 to-purple-700 text-white rounded-3xl shadow-xl px-8 py-10 mb-10">
		<div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-6">
			<div>
				<p class="text-sm uppercase tracking-wide opacity-80">Control Center</p>
				<h1 class="mt-2 text-3xl sm:text-4xl font-bold">Admin Dashboard</h1>
				<p class="mt-3 text-sm sm:text-base opacity-90 max-w-2xl">
					Monitor platform health, review recent activity, and adjust scoring parameters to keep the ATS experience sharp and reliable.
				</p>
			</div>
			<div class="flex flex-wrap gap-3">
				<a href="{% url 'admin_data' %}" class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-white/10 hover:bg-white/20 transition text-sm font-medium">
					<i class="fas fa-database"></i> View Platform Data
				</a>
				<a href="{% url 'admin_settings' %}" class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-white text-indigo-600 hover:bg-indigo-50 transition text-sm font-medium">
					<i class="fas fa-sliders-h"></i> Configure Scoring
				</a>
			</div>
		</div>
	</div>

	<div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6 mb-10">
		<div class="bg-white rounded-2xl shadow-md border border-gray-100 p-6">
			<p class="text-sm text-gray-500">Registered Users</p>
			<p class="mt-3 text-3xl font-semibold text-gray-900">{{ users|length }}</p>
			<p class="mt-1 text-xs text-gray-400">Includes all active and pending accounts</p>
		</div>
		<div class="bg-white rounded-2xl shadow-md border border-gray-100 p-6">
			<p class="text-sm text-gray-500">Recent Matches</p>
			<p class="mt-3 text-3xl font-semibold text-gray-900">{{ matches|length }}</p>
			<p class="mt-1 text-xs text-gray-400">Latest 50 attempts sorted by recency</p>
		</div>
		<div class="bg-white rounded-2xl shadow-md border border-gray-100 p-6">
			<p class="text-sm text-gray-500">System Logs</p>
			<p class="mt-3 text-3xl font-semibold text-gray-900">{{ logs|length }}</p>
			<p class="mt-1 text-xs text-gray-400">Most recent 100 audit entries</p>
		</div>
		<div class="bg-white rounded-2xl shadow-md border border-gray-100 p-6">
			<p class="text-sm text-gray-500">Scoring Weights</p>
			<div class="mt-3 space-y-1 text-gray-900">
				<p class="text-sm"><span class="font-semibold">Education:</span> {{ settings.weight_education|floatformat:2 }}</p>
				<p class="text-sm"><span class="font-semibold">Skills:</span> {{ settings.weight_skills|floatformat:2 }}</p>
				<p class="text-sm"><span class="font-semibold">Experience:</span> {{ settings.weight_experience|floatformat:2 }}</p>
			</div>
		</div>
	</div>

	<div class="grid grid-cols-1 xl:grid-cols-3 gap-8 mb-10">
		<div class="xl:col-span-2 bg-white rounded-2xl shadow-md border border-gray-100">
			<div class="flex items-center justify-between px-6 py-5 border-b border-gray-100">
				<div>
					<h2 class="text-lg font-semibold text-gray-900">Recent Match Attempts</h2>
					<p class="text-sm text-gray-500">Track how candidates are performing against job descriptions.</p>
				</div>
				<i class="fas fa-bullseye text-purple-500 text-xl"></i>
			</div>
			{% if matches %}
			<div class="overflow-x-auto">
				<table class="min-w-full divide-y divide-gray-100">
					<thead class="bg-gray-50 text-gray-600 text-xs uppercase tracking-wide">
						<tr>
							<th class="px-6 py-3 text-left">Candidate</th>
							<th class="px-6 py-3 text-left">Job Title</th>
							<th class="px-6 py-3 text-left">Score</th>
							<th class="px-6 py-3 text-left">Profession Fit</th>
							<th class="px-6 py-3 text-left">Ran At</th>
						</tr>
					</thead>
					<tbody class="divide-y divide-gray-100 text-sm">
						{% for match in matches %}
						<tr class="hover:bg-gray-50 transition">
							<td class="px-6 py-4">
								<p class="font-medium text-gray-900">{{ match.user.email }}</p>
								<p class="text-xs text-gray-500">Resume: {{ match.resume.filename|default:"N/A" }}</p>
							</td>
							<td class="px-6 py-4">
								<p class="font-medium text-gray-900">{{ match.job_description.title }}</p>
								<p class="text-xs text-gray-500">{{ match.job_description.created_at|date:"M d, Y" }}</p>
							</td>
							<td class="px-6 py-4">
								<span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-semibold {% if match.final_score >= 70 %}bg-green-100 text-green-700{% elif match.final_score >= 50 %}bg-yellow-100 text-yellow-700{% else %}bg-red-100 text-red-600{% endif %}">
									{{ match.final_score|floatformat:1 }}%
								</span>
							</td>
							<td class="px-6 py-4">
								{% if match.profession_match_flag %}
								<span class="inline-flex items-center gap-1 text-xs font-semibold text-green-600"><i class="fas fa-check-circle"></i>Aligned</span>
								{% else %}
								<span class="inline-flex items-center gap-1 text-xs font-semibold text-red-600"><i class="fas fa-exclamation-triangle"></i>Mismatch</span>
								{% endif %}
							</td>
							<td class="px-6 py-4 text-xs text-gray-500">{{ match.created_at|date:"M d, Y - g:i A" }}</td>
						</tr>
						{% endfor %}
					</tbody>
				</table>
			</div>
			{% else %}
			<div class="px-6 py-10 text-center text-gray-500">
				<i class="fas fa-inbox text-3xl text-gray-300 mb-3"></i>
				<p>No match attempts recorded yet.</p>
			</div>
			{% endif %}
		</div>

		<div class="bg-white rounded-2xl shadow-md border border-gray-100 overflow-hidden" id="admin-quick-actions">
			<div class="px-6 py-5 border-b border-gray-100 flex items-center justify-between">
				<div>
					<h2 class="text-lg font-semibold text-gray-900">Admin Quick Actions</h2>
					<p class="text-sm text-gray-500">Shortcuts for the tools you asked to keep.</p>
				</div>
				<i class="fas fa-bolt text-amber-500 text-xl"></i>
			</div>
			<div class="divide-y divide-gray-100">
				<a href="{% url 'admin_settings' %}" class="flex items-center justify-between px-6 py-4 hover:bg-gray-50 transition">
					<div>
						<p class="font-medium text-gray-900">Adjust Scoring Weights</p>
						<p class="text-xs text-gray-500">Update weighting, gating thresholds, and partial credit caps.</p>
					</div>
					<i class="fas fa-chevron-right text-gray-400"></i>
				</a>
				<a href="{% url 'admin_data' %}" class="flex items-center justify-between px-6 py-4 hover:bg-gray-50 transition">
					<div>
						<p class="font-medium text-gray-900">Browse Platform Data</p>
						<p class="text-xs text-gray-500">Inspect users, resumes, jobs, and match attempts in the custom viewer.</p>
					</div>
					<i class="fas fa-chevron-right text-gray-400"></i>
				</a>
			</div>
		</div>
	</div>

	<div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
		<div class="bg-white rounded-2xl shadow-md border border-gray-100">
			<div class="px-6 py-5 border-b border-gray-100 flex items-center justify-between">
				<div>
					<h2 class="text-lg font-semibold text-gray-900">Latest Users</h2>
					<p class="text-sm text-gray-500">Most recently created accounts.</p>
				</div>
				<i class="fas fa-users text-blue-500 text-xl"></i>
			</div>
			{% if users %}
			<ul class="divide-y divide-gray-100">
				{% for user in users|slice:':6' %}
				<li class="px-6 py-4 flex items-start justify-between">
					<div>
						<p class="font-medium text-gray-900">{{ user.email }}</p>
						<p class="text-xs text-gray-500">Joined {{ user.created_at|date:"M d, Y" }}</p>
					</div>
					<span class="text-xs px-2 py-1 rounded-full border {% if user.role == 'admin' %}border-purple-200 text-purple-600 bg-purple-50{% else %}border-gray-200 text-gray-600 bg-gray-50{% endif %}">
						{{ user.get_role_display }}
					</span>
				</li>
				{% endfor %}
			</ul>
			{% else %}
			<div class="px-6 py-10 text-center text-gray-500">
				<i class="fas fa-user-slash text-3xl text-gray-300 mb-3"></i>
				<p>No users found.</p>
			</div>
			{% endif %}
		</div>

		<div class="bg-white rounded-2xl shadow-md border border-gray-100">
			<div class="px-6 py-5 border-b border-gray-100 flex items-center justify-between">
				<div>
					<h2 class="text-lg font-semibold text-gray-900">System Activity</h2>
					<p class="text-sm text-gray-500">Recent audit log entries across the platform.</p>
				</div>
				<i class="fas fa-clipboard-list text-green-500 text-xl"></i>
			</div>
			{% if logs %}
			<div class="max-h-80 overflow-y-auto">
				<ul class="divide-y divide-gray-100 text-sm">
					{% for log in logs|slice:':8' %}
					<li class="px-6 py-4">
						<div class="flex items-center justify-between">
							<span class="font-semibold text-gray-900">{{ log.get_action_type_display }}</span>
							<span class="text-xs text-gray-400">{{ log.created_at|date:"M d, Y - g:i A" }}</span>
						</div>
						<p class="mt-1 text-xs text-gray-500">
							{% if log.user %}{{ log.user.email }}{% else %}-{% endif %}
							&bull; IP {{ log.ip_address|default:"-" }}
						</p>
					</li>
					{% endfor %}
				</ul>
			</div>
			{% else %}
			<div class="px-6 py-10 text-center text-gray-500">
				<i class="fas fa-clipboard text-3xl text-gray-300 mb-3"></i>
				<p>No system activity recorded.</p>
			</div>
			{% endif %}
		</div>
	</div>
</div>
{% endblock %}
